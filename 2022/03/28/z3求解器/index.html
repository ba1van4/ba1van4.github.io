<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark" type="image/x-icon" href="img/logo.jpg" />
	<link rel="shortcut icon" href="img/logo.jpg">
	<!-- icon patch -->
	<script src="https://kit.fontawesome.com/5b02cc00c3.js" crossorigin="anonymous"></script>
	
				    <title>
    ba1van4's heaven
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    <meta name="keywords" content="miccall" />
    
    	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	 
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>
    <style type="text/css">
        body:before {
          content: ' ';
          position: fixed;
          top: 0;
          background: url('/img/bg.jpg') center 0 no-repeat;
          right: 0;
          bottom: 0;
          left: 0;
          background-size: cover; 
        }
    </style>

					    
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script async type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
						
<meta name="generator" content="Hexo 6.1.0"></head>

			
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">Ba1van4</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">Main</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">Categories</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/helloworld/">helloworld</a></li><li><a class="category-link" href="/categories/mix/">mix</a></li><li><a class="category-link" href="/categories/python/">python</a></li><li><a class="category-link" href="/categories/re/">re</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="About">
		                About
		            </a>
		        </li>
		        
		        <li>
		            <a href="/friends/" title="Friends">
		                Friends
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="Gallery">
		                Gallery
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
                    
                    <li>
                        <a title="github" href="https://github.com/ba1van4" target="_blank" rel="noopener">
                            <i class="icon fa fa-github"></i>
                        </a>
                    </li>
                    
                    <li>
                        <a title="bilibili" href="https://space.bilibili.com/1743723079" target="_blank" rel="noopener">
                            <i class="icon fa fa-bilibili"></i>
                        </a>
                    </li>
                    
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url(/images/t1.png);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >z3</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <h1 id="z3求解器"><a href="#z3求解器" class="headerlink" title="z3求解器"></a>z3求解器</h1><p>周五晚上参加了vidar的分享会，感觉收获非常多（实际上一半都没听懂</p>
<p>但是！也可以好好总结一下上周的学习任务，比较简单（），学习z3，说实话虽然简单但是过程似乎并不是很顺利，但是还是要好好写第一篇记录学习！</p>
<p>第一次写加上python还不是很熟悉，可能不是很专业，而且只记下了比较常用的用法，一些细节还在推敲中，后面学得更深入会补充！如有问题和建议欢迎留言&gt;”&lt;</p>
<h2 id="装环境"><a href="#装环境" class="headerlink" title="装环境"></a>装环境</h2><p>没错这个过程真的太曲折了………本来可以不写的，但是多啰嗦一句来吸取教训，就是别在虚拟机里装………………</p>
<p>（我指的是我自己）</p>
<p>Windows的安装就简单很多啦，一句命令就可以</p>
<pre class=" language-python"><code class="language-python">pip install z3<span class="token operator">-</span>solver
</code></pre>
<p>注意注意注意！！！不要写成z3！！这俩库完全不一样！！！具体它是什么我也不知道</p>
<h2 id="简介绍"><a href="#简介绍" class="headerlink" title="简介绍"></a>简介绍</h2><p>确实是很简单的介绍，传统艺能查资料（）</p>
<blockquote>
<p>z3是微软开发的一个开源约束求解器。在工业应用中实际上常见于软件验证、程序分析等。然而由于功能实在强大，也被用于很多其他领域。CTF 领域来说，能够用约束求解器搞定的问题常见于密码题、二进制逆向、符号执行、Fuzzing 模糊测试等。</p>
</blockquote>
<h2 id="开始用"><a href="#开始用" class="headerlink" title="开始用"></a>开始用</h2><h3 id="解方程"><a href="#解方程" class="headerlink" title="解方程"></a>解方程</h3><p>在re中经常能看到需要解方程的题目，z3就提供了非常方便的语法，真·什么方程都能解！</p>
<p>可以通过Int定义整型未知数，z3里的Int型跟python的Int都是没有规定位数的，可以定义一个未知数，也可以一次性定义多个未知数，利用solve函数可以直接求解</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment" spellcheck="true"># 随意发挥想象的example</span>

x<span class="token operator">=</span>Int<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span>
y<span class="token operator">=</span>Int<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span>
a<span class="token punctuation">,</span>b<span class="token operator">=</span>Ints<span class="token punctuation">(</span><span class="token string">'a b'</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 定义多个变量</span>
solve<span class="token punctuation">(</span>x<span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span>y<span class="token operator">&lt;</span><span class="token number">5</span><span class="token punctuation">,</span>x<span class="token operator">+</span>y<span class="token operator">==</span><span class="token number">5</span><span class="token punctuation">)</span>
solve<span class="token punctuation">(</span>a<span class="token operator">></span><span class="token number">0</span><span class="token punctuation">,</span>b<span class="token operator">&lt;</span><span class="token number">2</span><span class="token punctuation">,</span>a<span class="token operator">**</span><span class="token number">2</span><span class="token operator">+</span>b<span class="token operator">**</span><span class="token number">2</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># [y = 0, x = 5]</span>
<span class="token comment" spellcheck="true"># [b = 0, a = 1]</span>
<span class="token comment" spellcheck="true"># 无解输出no solution</span>
</code></pre>
<p>除了Int，还可以定义实数（Real，位向量（BitVec，布尔（Bool等类型的未知数，语法都是一样的</p>
<p>逆向的时候常能看到各种作位运算的加密算法，用z3也可以解！但要注意的就是只有位向量能作位运算！！</p>
<p>可以看看改简单版本的Tea加密</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token comment" spellcheck="true"># 这里算法可能会有一点小问题，但是算法不是关键，关键是z3的语法，只是举一个简单的例子来熟悉用法！</span>

v0<span class="token operator">=</span>BitVec<span class="token punctuation">(</span><span class="token string">'v0'</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true"># 注意位向量的定义要规定位数</span>
v1<span class="token operator">=</span>BitVec<span class="token punctuation">(</span><span class="token string">'v1'</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">)</span>
v0 <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v1<span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v1 <span class="token operator">+</span> <span class="token number">0x12345678</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v1<span class="token operator">>></span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span>
v1 <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v0<span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span>v0 <span class="token operator">+</span> <span class="token number">0x12345678</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>v0<span class="token operator">>></span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">)</span>
x<span class="token operator">=</span>Solver<span class="token punctuation">(</span><span class="token punctuation">)</span>
x<span class="token punctuation">.</span>add<span class="token punctuation">(</span>v0<span class="token operator">==</span><span class="token number">305419852</span><span class="token punctuation">,</span>v1<span class="token operator">==</span><span class="token number">4424755894</span><span class="token punctuation">)</span>
<span class="token keyword">assert</span> x<span class="token punctuation">.</span>check<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span>sat
<span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>model<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment" spellcheck="true"># [v0 = 2, v1 = 3]</span>
</code></pre>
<p>顺带来解释一下更加常用的z3求解方程的方法！创建一个求解器x，通过add()创建约束条件，用check()来检查有没有解，有的话返回sat，否则返回unsat，接着可以通过print(x.model())来输出解</p>
<h3 id="创建多个变量"><a href="#创建多个变量" class="headerlink" title="创建多个变量"></a>创建多个变量</h3><p>在单字加密flag的时候就很好用了</p>
<pre class=" language-python"><code class="language-python"><span class="token keyword">from</span> z3 <span class="token keyword">import</span> <span class="token operator">*</span>

a<span class="token operator">=</span><span class="token punctuation">[</span>Int<span class="token punctuation">(</span><span class="token string">'a%d'</span> <span class="token operator">%</span> i <span class="token punctuation">)</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">#a1</span>
</code></pre>
<p>这样就创建好了五十个整型变量啦！</p>
<p>（未完待续）</p>
<p>参考链接</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://ericpony.github.io/z3py-tutorial/guide-examples.htm">https://ericpony.github.io/z3py-tutorial/guide-examples.htm</a></li>
<li><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/64d87659673a">https://www.jianshu.com/p/64d87659673a</a></li>
</ul>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-miccall-tech'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'https://ba1van4.icu/2022/03/28/z3%E6%B1%82%E8%A7%A3%E5%99%A8/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'https://ba1van4.icu/2022/03/28/z3%E6%B1%82%E8%A7%A3%E5%99%A8/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//http-miccall-tech.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a target="_blank" rel="noopener" href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a target="_blank" rel="noopener" href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
                <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



				

</html>